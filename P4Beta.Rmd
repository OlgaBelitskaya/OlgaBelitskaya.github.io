---
title: "P4: Explore and Summarize Data. Data of the Bank of Russia"
author: "Olga Belitskaya"
date: '21 августа 2016 г '
output: html_document
---

```{r global_options, include=FALSE}
# Setup the general options for code blocks
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```

# 1. Tools

##### Let's start the description of the project with definition of working tools: the directory for storing generated files, the list of downloaded packages and the collection of useful links.

## 1.1 Setup Working Directory

##### '/Users/olgabelitskaya/projects/nd002/Data_Analyst_ND_Project4'

https://github.com/OlgaBelitskaya/data-analyst-nd002/tree/master/Data_Analyst_ND_Project4

```{r Working_Directory}
# Setup working directory
setwd('/Users/olgabelitskaya/projects/nd002/Data_Analyst_ND_Project4')
# Creating the variable for the path for images
p='/Users/olgabelitskaya/projects/nd002/Data_Analyst_ND_Project4/figure_html/'
```

## 1.2 Useful links

1) http://www.theanalysisfactor.com/interpreting-regression-coefficients/

2) http://docs.ggplot2.org/current/coord_trans.html

3) https://www.r-bloggers.com/interpreting-regression-coefficient-in-r/?utm_source=feedburner&utm_medium=email&utm_campaign=Feed%3A+RBloggers+%28R+bloggers%29

4) http://personality-project.org/r/html/corr.test.html

5) https://rpubs.com/hadley/ggplot2-layers

6) http://rmarkdown.rstudio.com/articles_integration.html

7) https://http://blog.yhat.com/posts/r-lm-summary.html

8) http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/

9) http://data.princeton.edu/R/linearModels.html

10) https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf

## 1.3 Libraries

##### List of the libraries: 
devtools, knitr, markdown, ggplot2, ggthemes, RColorBrewer, gridExtra, scales,
reshape2, plyr, GGally, dplyr, tidyr, xlsx, lubridate, plotly, etc.

```{r Libraries_1}
# Loading and attaching add-on packages
library(devtools)
library(knitr)
library(markdown)
library(ggplot2)
library(ggthemes)
library(RColorBrewer)
library(gridExtra)
library(scales)
library(reshape2)
library(plyr)
library(GGally)
library(dplyr)
library(tidyr)
library(xlsx)
library(lubridate)
```

```{r Libraries_2}
# Loading and attaching add-on packages
library(corrplot)
library(PerformanceAnalytics)
library(plotly)
library(RCurl)
library(bitops)
library(memisc)
library(dygraphs)
library(xts)
```

# 2. Data

## 2.1 Introduction

##### I have chosen an open database of quotations of currencies and precious metals located on the site of the Bank of Russia. 

http://www.cbr.ru/Eng/hd_base/

##### I think it is easy to visualize the analysis of variables and dependencies in this case. From publicly available data the file in xlsx format has been generated and downloaded.

## 2.2 Load the Data and Review

##### Using suitable functions (read.xlsx, data.frame) I had read the file as a dataframe. It was called "centrobank". The function head() shows us several rows as an example.

```{r comment='', Data_1}
# Reading the data from the file
centrobank <- data.frame(read.xlsx("c_bank.xlsx",sheetName="Data",header=TRUE))
# Displaying the data example
head(centrobank,3)
```

##### First, there were no values "NA" in this dataframe. It was checked with a specially created set of rows with values "NA" - row.with.na. 

##### The code displays the number of this kind of rows. As we can see, it's zero.

```{r comment='', Data_2}
# Creating the variable for rows with values "NA"
row.with.na <- apply(centrobank, 1, function(x){any(is.na(x))})
# Creating the variable s for the number of rows with values "NA"
s <- sum(row.with.na)
# Displaying the number of rows with values "NA"
cat('sum(row.with.na) = ', s)
```

##### Second, let us have a look on the dataframe components (1128 observations of 20 variables; their types, values, etc.). Most of them have a numerical type. 

##### The function str() is very helpful and informative in this case.

```{r comment='', Data_3}
# Displaying the information about the variables in the data
str(centrobank)
```

##### Third, we should notice variables which are indicating exchange rates are measured in rubles, the prices of precious metals are denoted in rubles per gram, foreign exchange reserves and monetary gold reserves - in millions of US dollars for every month.

##### The special variable "dual currency basket" is calculated according to the formula: 0.55 USD + 0.45 EUR.

##### Foreign exchange reserves and monetary gold reserves consist of official datapoints for every month about the state reserves in Russia.

##### It's naturally to use the function summary() for revising all varibles. It gives us the complete observation of the dataset.

```{r comment='', Data_4}
# mean, median, 25th and 75th quartiles, min, max for all variables
summary(centrobank)
```

##### Finally, as we could see some variables (foreign_exchange_reserves, monetary_gold) have the wrong type. It means the investigation proceeds to the next step.

## 2.3 Cleaning and Managing Data

##### With some special functions I added the right category (numerical) for foreign_exchange_reserves and monetary_gold. 

##### The problem was a white space in every value of these columns. Two temporary variables ('temp1' and 'temp2') were created for transformed values without white spaces, then the type of these values was changed from "factor" to "numeric" together with inserting them into the columns foreign_exchange_reserves and monetary_gold. 

##### After the transformation process we can use the function summary() for these columns too.

```{r comment='', Data_5}
# Creating the variable for values without white spaces
centrobank$temp1 <- gsub(" ","", centrobank$foreign_exchange_reserves)
centrobank$temp2 <- gsub(" ","", centrobank$monetary_gold)

# Replacing the values of the variable with the wrong type
centrobank$foreign_exchange_reserves <- as.numeric(centrobank$temp1)
centrobank$monetary_gold <- as.numeric(centrobank$temp2)

# mean, median, 25th & 75th quartiles, min, max for new values of two variables
summary(centrobank$foreign_exchange_reserves)
summary(centrobank$monetary_gold)
```

##### The temporary variables were removed from our dataset. I created a variable "drop" for temporary columns and excluded them from the original dataset.

```{r comment='', Data_6}
# Creating the variable for two temporary columns
drops <- c("temp1","temp2")

# Deleting the temporary columns
centrobank <- centrobank[ , !(names(centrobank) %in% drops)]
```

##### For the next steps it would be useful to have variables with separated date indicators (days, months and years), so I added these variables. For "days" and "years" I had chosen the numerical type, for "months" - categorical (chr). 

##### Let's check the characteristics of the variables again:

```{r comment='', Data_7}
# Creating the variables for days, months and years
centrobank$day= as.numeric(format(centrobank$date, "%d"))
centrobank$month = format(centrobank$date, "%B") 
centrobank$year = as.numeric(format(centrobank$date, "%Y"))
# Displaying the information about the variables in the data
str(centrobank)
```

##### Now there are 23 variables in the dataset without problems for analyzing.

# 3. Univariate Plots Section

## 3.1 Univariate Plots

##### 3.1.1 Histograms of the distribution for all the analyzed variables.

##### The package "ggplot2" helps us to create them with a wide set of functions.

##### The histogram for the distribution of the dual currency basket I put first because I think it is the most important indicator for the economic situation in the currency market.

```{r  fig.width=8, fig.height=6, Univariate_Plots_0}
# Creating the histogram 
p0 <- ggplot(aes(x = dual_currency_basket), data = centrobank) + 
# options for the histogram  
  geom_histogram(binwidth = 1, color = 'purple', aes(fill = ..count..)) + 
# options for the x-scale
  scale_x_continuous(name = 'dual currency basket, rubles', 
                     limits=c(32, 88), breaks=seq(32, 88, 2)) + 
# options for the color scheme  
  scale_fill_gradientn(colours=terrain.colors(20)) + 
# applying the theme  
  theme_bw() + 
# options for the x-axis
  theme(axis.text.x=
          element_text(size=8,angle=5),axis.title=element_text(size=12))
# Displaying the histogram
p0
```

##### Then the histograms for the distribution of prices for precious metals in rubles were placed. They were built and grouped with using the packages "ggplot2" and "gridExtra".

```{r Univariate_Plots_1}
# Creating the histogram by analogy with the p0
p1 <- ggplot(aes(x = gold), data = centrobank) + 
  geom_histogram(binwidth = 50, color = 'purple', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'gold, rubles per gram', 
                     limits=c(1200, 3200), breaks=seq(1200, 3200, 50)) + 
  scale_fill_gradientn(colours=heat.colors(20)) + 
  theme_bw() + 
  theme(axis.text.x=element_text(size=10, angle=85),
        axis.title=element_text(size=12))
```

```{r Univariate_Plots_2}
# Creating the histogram by analogy with the p0
p2 <- ggplot(aes(x = silver), data = centrobank) + 
  geom_histogram(binwidth = 0.5, color ='darkblue', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'silver, rubles per gram', 
                     limits = c(19, 44), breaks = seq(19, 44, 0.5)) + 
  scale_fill_gradientn(colours=terrain.colors(20)) + 
  theme_bw() + 
  theme(axis.text.x=element_text(size=10, angle=85),
        axis.title=element_text(size=12))
```

```{r Univariate_Plots_3}
# Creating the histogram by analogy with the p0
p3 <- ggplot(aes(x = platinum), data = centrobank) + 
  geom_histogram(binwidth = 50, color = 'darkmagenta', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'platinum, rubles per gram', 
                     limits = c(1200, 2800), breaks=seq(1200, 2800, 50)) + 
  scale_fill_gradientn(colours=heat.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=10, angle=85),
                     axis.title=element_text(size=12))
```

```{r Univariate_Plots_4}
# Creating the histogram by analogy with the p0
p4 <- ggplot(aes(x = palladium), data = centrobank) + 
  geom_histogram(binwidth = 30, color = 'blue', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'palladium, rubles per gram', 
                     limits = c(550, 1750), breaks=seq(550, 1750, 30)) + 
  scale_fill_gradientn(colours=terrain.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=10, angle=85),
                     axis.title=element_text(size=12))
```

```{r fig.width=15, fig.height=10, Univariate_Plots_5}
# Combining the histograms
g101 <- grid.arrange(p1, p2, p3, p4, ncol = 2)
# Creating the path for the image
path01=paste(p, 'Univariate_Plots_5_1.png', sep = '')
# Saving the image with histograms
ggsave(path01, g101, width = 18, height = 24) 
```

##### We will also examine the histograms for the distribution of prices for the main currencies in the Russian market (euro and dollars), as well as the histograms of foreign exchange reserves and monetary gold.

```{r Univariate_Plots_6}
# Creating the histogram by analogy with the p0
p101 <- ggplot(aes(x = EUR_978), data = centrobank) + 
  geom_histogram(binwidth = 1, color = 'navy', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'EUR, rubles', 
                     limits=c(38, 92), breaks=seq(38, 92, 2)) + 
  scale_fill_gradientn(colours=heat.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=5),
                     axis.title=element_text(size=12))
```

```{r Univariate_Plots_7}
# Creating the histogram by analogy with the p0
p102 <- ggplot(aes(x = USD_840), data = centrobank) + 
  geom_histogram(binwidth = 1, color ='darkblue', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'USD, rubles', 
                     limits = c(28, 84), breaks = seq(28, 84, 2)) + 
  scale_fill_gradientn(colours=terrain.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=5),
                     axis.title=element_text(size=12))
```

```{r Univariate_Plots_8}
p103 <- ggplot(aes(x =foreign_exchange_reserves), data = centrobank) + 
  geom_histogram(binwidth = 5000, color = 'darkmagenta', aes(fill = ..count..))+ 
  scale_x_continuous(name = 'foreign exchange reserves, mln. USD', 
                     limits =c(305000, 490000),breaks=seq(305000,490000,10000))+ 
  scale_fill_gradientn(colours=cm.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=85),
                     axis.title=element_text(size=12))
```

```{r Univariate_Plots_9}
# Creating the histogram by analogy with the p0
p104 <- ggplot(aes(x = monetary_gold), data = centrobank) + 
  geom_histogram(binwidth = 500, color = 'blue', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'monetary gold, mln.USD', 
                     limits = c(38500, 63500), breaks=seq(38500, 63500, 1000)) + 
  scale_fill_gradientn(colours=cm.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=85),
                     axis.title=element_text(size=12))
```

```{r fig.width=15, fig.height=10, Univariate_Plots_10}
# Combining the histograms
g102 <- grid.arrange(p101, p102, p103, p104, ncol = 2)
# Creating the path for the image
path02=paste(p, 'Univariate_Plots_10_1.png', sep = '')
# Saving the image with histograms
ggsave(path02, g102, width = 18, height = 24) 
```

##### To understand and predict the situation in the currency market it is necessary to discover the histograms of other currencies (Brazilian real, Japanese yen, Chinese yuan and Indian rupee).

```{r Univariate_Plots_11}
# Creating the histogram by analogy with the p0
p105 <- ggplot(aes(x = BRL_986), data = centrobank) + 
  geom_histogram(binwidth = 0.25, color = 'navy', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'BRL, rubles', 
                     limits=c(13, 27), breaks=seq(13, 27, 0.5)) + 
  scale_fill_gradientn(colours=heat.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=85),
                     axis.title=element_text(size=12))
```

```{r Univariate_Plots_12}
# Creating the histogram by analogy with the p0
p106 <- ggplot(aes(x = JPY_392), data = centrobank) + 
  geom_histogram(binwidth = 0.01, color ='darkblue', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'JPY, rubles', 
                     limits = c(0.3, 0.72), breaks = seq(0.3, 0.72, 0.02)) + 
  scale_fill_gradientn(colours=terrain.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=5),
                     axis.title=element_text(size=12))
```

```{r Univariate_Plots_13}
# Creating the histogram by analogy with the p0
p107 <- ggplot(aes(x =CNY_156), data = centrobank) + 
  geom_histogram(binwidth = 0.2, color='darkmagenta', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'CNY, rubles', limits = c(4.4, 12.8), 
                     breaks=seq(4.4,12.8, 0.4)) + 
  scale_fill_gradientn(colours=terrain.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=5),
                     axis.title=element_text(size=12))
```

```{r Univariate_Plots_14}
# Creating the histogram by analogy with the p0
p108 <- ggplot(aes(x = INR_356), data = centrobank) + 
  geom_histogram(binwidth = 0.02, color = 'blue', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'INR, rubles', limits = c(0.45, 1.25), 
                     breaks=seq(0.45, 1.25, 0.04)) + 
  scale_fill_gradientn(colours=terrain.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=5),
                     axis.title=element_text(size=12))
```

```{r fig.width=15, fig.height=10, Univariate_Plots_15}
# Combining the histograms
g103 <- grid.arrange(p105, p106, p107, p108, ncol = 2)
# Creating the path for the image
path03=paste(p, 'Univariate_Plots_15_1.png', sep = '')
# Saving the image with histograms
ggsave(path03, g103, width = 18, height = 24) 
```

##### 3.1.2 Box plots for every significant variable.

##### I used for creating them the functions of "gglot2" as well.

##### It helps to discover outliers for the indicators. I put together all the graphics for understanding outliers of economical variables in general. With color I divided them into groups: orange - USD and EUR, brown - Asian currencies, purple - Brazilian real, blue - precious metals, red - foreign exchange reserves, green - monetary gold.

##### I didn't include the variable "dual_currency_basket", it depends from EUR and USD and its outliers as well.

```{r Univariate_Plots_16}
# Creating the box plots
p112 <- ggplot(centrobank, aes( x = 1, y = EUR_978)) + geom_boxplot() + 
# options for points
  geom_jitter(alpha=0.4, size = 1, color = 'orange') +
# adding the marker for mean
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=8, size=3)

# Creating the box plots by analogy with the p112
p113 <- ggplot(centrobank, aes( x = 1, y = USD_840)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, size= 1, color = 'orange') +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=8, size=3)

# Creating the box plots by analogy with the p112
p114 <- ggplot(centrobank, aes( x = 1, y = JPY_392)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, size = 1, color = 'brown') +
  stat_summary(fun.y=mean, colour="black", geom="point", 
               shape=8, size=3)

# Creating the box plots by analogy with the p112
p115 <- ggplot(centrobank, aes( x = 1, y = CNY_156)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, size = 1, color = 'brown') +
  stat_summary(fun.y=mean, colour="black", geom="point", 
               shape=8, size=3)

# Creating the box plots by analogy with the p112
p116 <- ggplot(centrobank, aes( x = 1, y = INR_356)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, size = 1, color = 'brown') +
  stat_summary(fun.y=mean, colour="black", geom="point", 
               shape=8, size=3)

# Creating the box plots by analogy with the p112
p117 <- ggplot(centrobank, aes( x = 1, y = BRL_986)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, size = 1, color = 'purple') + 
  stat_summary(fun.y=mean, colour="black", geom="point", 
               shape=8, size=3)

# Creating the box plots by analogy with the p112
p120 <- ggplot(centrobank, aes( x = 1, y = gold)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, size = 1, color = 'blue') +
  stat_summary(fun.y=mean, colour="darkblue", geom="point", 
               shape=8, size=3)

# Creating the box plots by analogy with the p112
p121 <- ggplot(centrobank, aes( x = 1, y = silver)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, size = 1, color = 'blue') +
  stat_summary(fun.y=mean, colour="darkblue", geom="point", 
               shape=8, size=3)  

# Creating the box plots by analogy with the p112
p122 <- ggplot(centrobank, aes( x = 1, y = platinum)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, size = 1, color = 'blue') +
  stat_summary(fun.y=mean, colour="darkblue", geom="point", 
               shape=8, size=3)

# Creating the box plots by analogy with the p112
p123 <- ggplot(centrobank, aes( x = 1, y = palladium)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, color = 'blue') + 
  stat_summary(fun.y=mean, colour="darkblue", geom="point", 
               shape=8, size=3)

# Creating the box plots by analogy with the p112
p118 <- ggplot(centrobank, aes( x = 1, y = foreign_exchange_reserves)) + 
  geom_boxplot() +  geom_jitter(alpha=0.4, color = 'red') +
  stat_summary(fun.y=mean, colour="brown", geom="point", 
               shape=8, size=3)

# Creating the box plots by analogy with the p112
p119 <- ggplot(centrobank, aes( x = 1, y = monetary_gold)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, color = 'green') +
  stat_summary(fun.y=mean, colour="darkgreen", geom="point", 
               shape=8, size=3)
```

```{r fig.width=14, fig.height=8, Univariate_Plots_17}
# Combining the box plots
g104<- grid.arrange(p112, p113, p114, p115, p116, p117, 
                    p118, p119, p120, p121, p122, p123, ncol = 4)
# Creating the path for the image
path06=paste(p, 'Univariate_Plots_17_1.png', sep = '')
# Saving the image with plots
ggsave(path06, g104, width = 12, height = 24) 
```

##### All box plots have important indicators: min, max, median, quartiles. Means were marked with points, they were made with the function stat_summary().

##### X-axis is just a unit for creating box plots.

## 3.2. Univariate Analysis

##### The structure of my data is the set of the main financial indicators. Only with the first look at the data we could see the similar tendencies in many different cases. So we could predict many dependencies between our variables.

##### Also these indicators show the situation in the country economy in general. For sure it's an interesting subject for investigations.

##### Now we will discuss the obtained visualization.

##### The graphic description of histograms: most of them have a non-symmetrical form, skewed right and multimodal. For histograms where we could see a tendency to be unimodal I have used the heat palette of colors, for histograms that looks to have a tendency to be bimodal - the terrain palette of colors. In practice it means that the variables with unimodal histograms were stable at a certain interval for a sufficiently long period of time; for bimodal histograms there were two not so long periods of stability. Dispersion of all indicators is also quite large. 

##### The histograms for "foreign_exchange_reserves" and "monetary_gold" have a complicated form with many gaps. I have marked it with a special palette.

##### I didn't describe every histogram separately because many variables have very similar behaviour and distribution. We will see it much clearly on the next steps.

##### Let's discuss outliers on the last graph in this section. When we see all of them we can find immediately even without exact calculation of deviations from the general trend: there are too many outliers here. It shows the influence of the economical variables which are not included into this dataset. If we exclude outliers in this case we could lose important tendency and the material for next discoveries. If the reasons for many frequent and sharp deviations are not explained I want to keep these data points in observation.

# 4 Bivariate Plots Section

## 4.1 Bivariate Plots

##### 4.1.1 Plots for all pairs of variables.

##### Let's start the section "Bivariate Plots" with graphs of the correlation analysis. It helps to improve understanding the strong relationships between variables in this dataset.

##### I had choosed the R-packages "PerformanceAnalytics" and "corrplot". I created a new dataset only with 13 important variables.

```{r comment='', Correlation_Plots_1}
# Creating the variable for names of main indicators
include <- c("dual_currency_basket", "EUR_978", "USD_840", "JPY_392", "CNY_156", 
             "BRL_986", "INR_356", "gold", "silver", "platinum", "palladium",
             "foreign_exchange_reserves", "monetary_gold")
# Creating the subset with main indicators
corr_centrobank <- (centrobank[,include])
# Displaying the information about the variables in the subset
str(corr_centrobank)
```

##### The function chart.Correlation() let us display correlations between all these variables.

```{r fig.width=18, fig.height=24, comment='', Correlation_Plots_2}
# Creating the correlation chart with "PerformanceAnalytics" 
chart.Correlation(corr_centrobank, histogram=TRUE, pch=19)
```

##### And I added one correlation chart else with a special color indicator for levels of relationships between variables.

```{r fig.width=12, fig.height=12, Correlation_Plots_3}
# Creating the correlation matrix
mcorr_centrobank <- cor(corr_centrobank)
# Creating the correlation chart with "corrplot"
corrplot.mixed(mcorr_centrobank, lower="number", upper="pie", 
               order ="AOE", tl.col="darkblue", tl.cex=0.5)
```

##### The tables show a strong correlation between the number of variables, we will examine in details only some of them.

##### 4.1.2 Plots for exchange rates (BRL 986, JPY 392, CNY 156, INR 356).

##### Let's have a look on behavior of rates for Brazilian real, Japanese yen, Chinese yuan and Indian rupee. We will explore changes with time.

##### The packages "ggplot2" and "gridExtra" are very convenient for combining many plots together. 

```{r Bivariate_Plots_1}
# Creating the scatter plot
p5 <- ggplot(centrobank, 
             aes(x = date, y = BRL_986, 
# point colors
                 color = format(as.Date(date, format='%d/%m/%Y'), "%Y"))) + 
# point options
  geom_point(size = 2, shape = 5) + 
# options of the smooth line
  geom_smooth(method = "lm", se = FALSE, size=1) + 
# options of the color scale 
  scale_colour_brewer(palette='Set1') + 
# applying the theme  
  theme_bw()+
# options of the legend  
  guides(color=guide_legend(title="year", direction = "horizontal"))
```

```{r Bivariate_Plots_2}
# Creating the scatter plot by analogy with the p5
p6 <- ggplot(centrobank, 
             aes(x = date, y = JPY_392, 
                 color = format(as.Date(date, format='%d/%m/%Y'), "%Y"))) + 
  geom_point(size = 2, shape = 5) + 
  geom_smooth(method = "lm", se = FALSE, size=1)+
  scale_colour_brewer(palette='Spectral') + theme_bw()
```

```{r Bivariate_Plots_3}
# Creating the scatter plot by analogy with the p5
p7 <- ggplot(centrobank, 
             aes(x = date, y = CNY_156, 
                 color = format(as.Date(date, format='%d/%m/%Y'), "%Y"))) + 
  geom_point(size = 2, shape = 5) + 
  geom_smooth(method = "lm", se = FALSE, size=1)+
  scale_colour_brewer(palette='Spectral') + theme_bw()
```

```{r Bivariate_Plots_4}
# Creating the scatter plot by analogy with the p5
p8 <- ggplot(centrobank, 
             aes(x = date, y = INR_356, 
                 color = format(as.Date(date, format='%d/%m/%Y'), "%Y"))) + 
  geom_point(size = 2, shape = 5) + 
  geom_smooth(method = "lm", se = FALSE, size=1)+
  scale_colour_brewer(palette='Spectral') + theme_bw()
```

##### For creating the common legend for several graphs the function get_legend() from the website
http://stackoverflow.com/questions/24954912/sharing-a-legend-between-two-combined-ggplots

##### was applied. The image was saved as a file as well.

```{r fig.width=14, fig.height=10, Bivariate_Plots_5}
# Creating the function for the common legend
get_legend <- function(myggplot){
  tmp <- ggplot_gtable(ggplot_build(myggplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)
}
# Creating the variable for legend options of the plot p5
legend_g2 <- get_legend(p5)
# Combining the plots with the common legend
g2 <- grid.arrange(arrangeGrob(p5 + theme(legend.position="none"),
                               p6 + theme(legend.position="none"),
                               p7 + theme(legend.position="none"),
                               p8 + theme(legend.position="none"),
                               ncol=2),
                   legend_g2, 
                   ncol=1, heights=c(19, 1))
# Creating the path for the image
path04=paste(p, 'Bivariate_Plots_5_1.png', sep = '')
# Saving the image with plots
ggsave(path04, g2, width = 24, height = 18) 
```

##### The similarity of tendencies in rates of Asian currencies is underlined by the common color solution for them.

##### 4.1.3 Plots for foreign exchange and monetary gold reserves.

##### And for other two variables "foreign_exchange_reserves" and "monetary_gold" could see the changes step by step also.

##### The breadth of fluctuations in values is emphasized by color decision with the function scale_colour_gradientn().

```{r Bivariate_Plots_6}
# Creating the scatter plot 
p9 <- ggplot(centrobank, 
             aes(x = date, y=foreign_exchange_reserves, 
                 color = foreign_exchange_reserves)) + 
# point options
  geom_jitter(size = 2, alpha=0.3, shape = 6) + 
# options of the color palette
  scale_colour_gradientn(colours=rainbow(10)) + 
# options of the smooth line
  geom_smooth(aes(y=foreign_exchange_reserves), color = '#FF6633') + 
# applying the theme
  theme_bw() + 
# y-axis name
  ylab('foreign exchange reserves, millions of US dollars')
```

```{r Bivariate_Plots_7}
# Creating the scatter plot by analogy with the p9
p10 <- ggplot(centrobank, 
              aes(x=date,y=monetary_gold,color = monetary_gold)) + 
  geom_jitter(size = 2, alpha=0.3, shape = 6) + 
  scale_colour_gradientn(colours=rainbow(10)) + 
  geom_smooth(aes(y=monetary_gold), color = '#00FFFF') + theme_bw() + 
  ylab('monetary gold reserves, millions of US dollars')
```

```{r fig.width=14, fig.height=8, Bivariate_Plots_8}
# Combining the plots
g3 <- grid.arrange(p9, p10, ncol = 1)
# Creating the path for the image
path05=paste(p, 'Bivariate_Plots_8_1.png', sep = '')
# Saving the image with plots
ggsave(path05, g3, width = 12, height = 24) 
```


##### 4.1.4 Plots for prices of precious metals and the dual currency basket.

```{r Bivariate_Plots_9}
# Creating the scatter plot
p11 <- ggplot(centrobank, 
              aes(x=dual_currency_basket, y=gold, color = gold)) + 
# options for points and for the smooth line
  geom_point() + geom_smooth(color = 'darkred') + 
# options for the color palette and for the theme
  scale_colour_gradientn(colours=heat.colors(10)) + theme_bw()
```

```{r Bivariate_Plots_10}
# Creating the scatter plot by analogy with the p11
p12 <- ggplot(centrobank, 
              aes(x=dual_currency_basket,y=silver,color = silver)) + 
  geom_point() + geom_smooth(color = 'darkgreen') + 
  scale_colour_gradientn(colours=terrain.colors(10)) + theme_bw()
```

```{r Bivariate_Plots_11}
# Creating the scatter plot by analogy with the p11
p13 <- ggplot(centrobank, 
              aes (x=dual_currency_basket, y=platinum, color = platinum)) + 
  geom_point() + 
  geom_smooth(color='darkred') + 
  scale_colour_gradientn(colours=heat.colors(10)) + theme_bw()
```

```{r Bivariate_Plots_12}
# Creating the scatter plot by analogy with the p11
p14 <- ggplot(centrobank, aes (x=dual_currency_basket, y=palladium, 
                               color = palladium)) + 
  geom_point() + geom_smooth(color = 'darkgreen') + 
  scale_colour_gradientn(colours=terrain.colors(10)) + theme_bw()
```

```{r fig.width=14, fig.height=8, Bivariate_Plots_13}
# Combining the plots
g4 <- grid.arrange(p11, p12, p13, p14, ncol = 2)
# Creating the path for the image
path07=paste(p, 'Bivariate_Plots_13_1.png', sep = '')
# Saving the image with plots
ggsave(path07, g4, width = 18, height = 24) 
```

##### The graph for variables "silver" and "dual currency basket" has the most complex structure. The rest of the graphics in this section is quite close to the linear tendency (especially for the pair "gold" and "dual currency basket").

##### 4.1.5 Plots for Asian exchange rates and the dual currency basket.

##### The function geom_smooth() helps to evaluate the dependence of one variable on the other.

```{r Bivariate_Plots_14}
# Creating the scatter plot by analogy with the p11
p15 <- ggplot(centrobank, 
              aes(x=dual_currency_basket,y=JPY_392,color=JPY_392)) + 
  geom_point() + geom_smooth(color = 'darkred') + 
  scale_colour_gradientn(colours=heat.colors(10)) + theme_bw()
```

```{r Bivariate_Plots_15}
# Creating the scatter plot by analogy with the p11
p16 <- ggplot(centrobank,
              aes(x=dual_currency_basket,y=CNY_156,color = CNY_156))+ 
  geom_point() + geom_smooth(color = 'darkred') + 
  scale_colour_gradientn(colours=heat.colors(10)) + theme_bw()
```

```{r Bivariate_Plots_16}
# Creating the scatter plot by analogy with the p11
p17 <- ggplot(centrobank,
              aes(x=dual_currency_basket,y=INR_356,color=INR_356)) + 
  geom_point() + geom_smooth(color='darkred')+ 
  scale_colour_gradientn(colours=heat.colors(10)) + theme_bw()
```

```{r Bivariate_Plots_17}
# Creating the scatter plot by analogy with the p11
p18 <- ggplot(centrobank, 
              aes (x=JPY_392, y=CNY_156, color = CNY_156)) + 
  geom_point() + geom_smooth(color = 'darkgreen') + 
  scale_colour_gradientn(colours=terrain.colors(10)) + theme_bw()
```

```{r Bivariate_Plots_18}
# Creating the scatter plot by analogy with the p11
p19 <- ggplot(centrobank, 
              aes (x=CNY_156, y=INR_356, color = INR_356)) + 
  geom_point() + geom_smooth(color = 'darkgreen') + 
  scale_colour_gradientn(colours=terrain.colors(10)) + theme_bw()
```

```{r Bivariate_Plots_19}
# Creating the scatter plot by analogy with the p11
p20 <- ggplot(centrobank, aes (x=JPY_392, y=INR_356, color = INR_356)) + 
  geom_point() + geom_smooth(color = 'darkgreen') + 
  scale_colour_gradientn(colours=terrain.colors(10)) + theme_bw()
```

```{r fig.width=14, fig.height=12, Bivariate_Plots_20}
# Combining displaying the plots
g5 <- grid.arrange(p15, p16, p17, p18, p19, p20, ncol = 3)
# Creating the path for the image
path08=paste(p, 'Bivariate_Plots_20_1.png', sep = '')
# Saving the image with plots
ggsave(path08, g5, width = 18, height = 24) 
```

##### It shows again how identical the trends which Asian currencies demonstrate.

##### 4.1.6 Plots for foreign exchange reserves and monetary gold reserves.

```{r Bivariate_Plots_21}
# Creating the scatter plot by analogy with the p11
p21 <- ggplot(centrobank, aes (x=foreign_exchange_reserves, 
                               y=monetary_gold, color = monetary_gold)) + 
  geom_jitter(shape = 13, size = 4) + geom_smooth(color = '#00FF99') + 
  scale_colour_gradientn(colours=terrain.colors(10)) + theme_bw()
# Displaying the plot
p21
# Creating the path for the image
path09=paste(p, 'Bivariate_Plots_21_1.png', sep = '')
# Saving the image with plots
ggsave(path09, p21, width = 12, height = 8)
```

##### There is a complex nonlinear dependency on the last graph, so let's discuss it in the next section.

## 4.2 Bivariate Analysis

##### Let's start this section with some notes about visual observation.

##### The significant price increase for precious metals in relation to the national currency allows us to consider that the precious metals are reasonable reserves for the long terms.

##### Bivariate graphs show various exchange trends for the Brazilian real and the Asian currencies. The Brazilian real has one rise relative to the Russian ruble, Asian currencies have many peaks. However, there are certain similarities too: a period of small oscillations in the beginning of the chart gave way to a period of sharp spikes.

##### The plots for foreign exchange and monetary gold reserves demonstrate diametrically opposed situation in the resources in the second half of the time interval: the foreign exchange reserves show a downward trend, stocks of monetary gold - a steady rise.

##### Then we can continue to analize with correlation tests for these plotted pairs of variables.

##### The function cor.test() helps to test for association between paired samples, using one of Pearson's product moment correlation coefficient.

```{r comment='', Correlation_Tests_1}
# Testing and displaying the results of the correlation tests 
with(centrobank, cor.test(dual_currency_basket, gold))
with(centrobank, cor.test(dual_currency_basket, silver))
with(centrobank, cor.test(dual_currency_basket, platinum))
with(centrobank, cor.test(dual_currency_basket, palladium))
```

```{r comment='', Correlation_Tests_2}
# Testing and displaying the results of the correlation tests 
with(centrobank, cor.test(dual_currency_basket, JPY_392))
with(centrobank, cor.test(dual_currency_basket, CNY_156))
with(centrobank, cor.test(dual_currency_basket, INR_356))
with(centrobank, cor.test(JPY_392, CNY_156))
with(centrobank, cor.test(JPY_392, INR_356))
with(centrobank, cor.test(INR_356, CNY_156))
```

```{r comment='', Correlation_Tests_3}
# Testing and displaying the results of the correlation tests 
with(centrobank, cor.test(foreign_exchange_reserves, monetary_gold))
```

##### Most of the observed relationships have strong positive correlation (dual_currency_basket & gold, dual_currency_basket & platinum, dual_currency_basket & palladium, dual_currency_basket & JPY-392, dual_currency_basket & INR-356, dual_currency_basket & CNY-156, JPY-392 & CNY-156, JPY-392 & INR-356, INR-356 & CNY-156). A moderate positive relationship is between dual_currency_basket & silver; a weak negative relationship - between foreign_exchange_reserves & monetary_gold. 

##### The strongest relationship I had found is between dual_currency_basket & CNY-156.

##### The revealed dependencies are based on cause-and-effect relationships, the fall of the national currency value in relation to a set of major currencies undoubtedly leads to the fall of this indicator in relation to other currencies and precious metals. 

##### Even a weak relationship between foreign exchange reserves and monetary gold reserves does not look accidental: reduced confidence to the foreign exchange reserves of the state leads to the accumulation of resources in another equivalent.

# 5 Multivariate Plots Section

## 5.1 Multivariate Plots

##### 5.1.1 A plot for dual currency basket and gold price per year.

##### Here we will use the added variable "year" to analyze the relationships between two other variables. For better visual results I had used the function facet_wrap() for faceting by year.

```{r fig.width=10, fig.height=6, comment='', Multivariate_Plots_1}
# Creating the scatter plot
p24 <- ggplot(centrobank, 
              aes(x=dual_currency_basket, y = gold, color = year))+
# options of point and the smooth line
  geom_point(shape=10, alpha=0.5, size = 2) + geom_smooth() +
# faceting by year
  facet_wrap( ~ year, ncol=3, scale = 'free') + 
# options for the color palette and for the theme
  scale_colour_gradientn(colours=heat.colors(5)) + theme_bw() +
# title
  ggtitle('Gold prices and dual currency basket in 2012-2016, rubles')
# Displaying the plot
p24
# Creating the path for the image
path10=paste(p, 'Multivariate_Plots_1_1.png', sep = '')
# Saving the image with plots
ggsave(path10, p24, width = 18, height = 12)
```

##### 5.1.2 A plot for exchange rates (JPY, CNY, INR) and gold price.

##### Here one of the most effective packages "plotly" was applied. I used a 3D scatterplot.

```{r fig.width=8, fig.height=6, Multivariate_Plots_2}
# Creating the 3D-scatter plot with options(text, marker, color, etc.)
pl1 <- plot_ly(centrobank, x=JPY_392, y=CNY_156, 
               z=INR_356, color = gold, 
               text = paste(date, "gold price: ", gold), 
               colors = 'Spectral', type="scatter3d", mode="markers", 
               marker = list(size = 8, symbol = "circle-open"))
# Creating layout of the plot
pl2 <- layout(pl1, title = "Prices for Gold and Rates for JPY, CNY, INR",
         scene = list(
           xaxis = list(title = "JPY 392"), 
           yaxis = list(title = "CNY 156"), 
           zaxis = list(title = "INR_356")))
# Displaying the plot
pl2
```

##### I have purposely used the 3-dimensional image to show how limited the space which contains the graph of three indicators for exchange rates, it means there is a strong connection between all these variables. At the same time the periods of increasing the exchange rates in many cases coincides with the growth of the prices of gold. And at least twice we can see the returning to the previous levels of prices for this metal. So we should discover the reason for these events.

##### With color I highlighted specially some other important tendencies: I wanted to show once again the width of changing for the variable "price of gold" and identify for myself tentative boundaries of these changes. Fragments of the chart on which significant changes have occurred indicate the influence of factors that must be find and identify (the prices of oil, economic sanctions, etc.). 

##### 5.1.3 A plot for prices of precious metals (gold, silver, platinum) and the dual currency basket.

##### To organize the graph space (titles, axes, etc.) the function layout() was used.

```{r fig.width=8, fig.height=6, Multivariate_Plots_3}
# Creating the 3D-scatter plot with options(text, marker, color, etc.)
pl3 <- plot_ly(centrobank, x=gold, y=silver, z=platinum, 
               color = dual_currency_basket, 
               text = paste(date, 
                            "dual currency basket: ", dual_currency_basket), 
               colors = 'Spectral', type="scatter3d", mode="markers", 
               marker = list(size = 8, symbol = "diamond-open"))
# Creating layout of the plot
pl4 <- layout(pl3, title = "Prices for Gold, Silver, 
              Platinum and Dual Currency Basket",
         scene = list(
           xaxis = list(title = "gold"), 
           yaxis = list(title = "silver"), 
           zaxis = list(title = "platinum")))
# Displaying the plot
pl4
```

##### By adding a variable "price of silver", we can see a different picture: a region of space occupied by the graph is much wider, and therefore the relationship between three variables (gold, silver and platinum) is weaker.

##### The periods of increasing the cost of the dual currency basket (and for exchange rates USD and EUR) in general coincides with the growth of the prices of precious metals.

##### 5.1.4 A plot for the ratio of year means 

##### Let me introduce artificial variables, showing the ratio of year means of the precious metals prices to year means of the cost of dual currency basket. For ease of combining on the same graph, the prices of gold, platinum and palladium are for 1 g, the price of silver - for 100 g.

##### I created the dataset centrobank_y with means per year and the variable centrobank_y$silver100 for this goal.

```{r Multivariate_Plots_4}
# Creating the new dataset with year means 
centrobank_y <- aggregate(corr_centrobank, list(centrobank$year), mean)
# Adding the variable for the price of 100 g of silver
centrobank_y$silver100 <- 100*centrobank_y$silver
```

##### To combine charts for four metals I used the function add_trace().

```{r fig.width=10, fig.height=7, Multivariate_Plots_5}
# Adding the variables for the title and names of axes
t1='Year Means of Prices for Precious Metals/Year means of Dual Currency Basket'
x1 = 'year'
y1 = 'mean of prices for precious metals/mean of dual currency basket'
# Creating the bar plot
p130 <- plot_ly(centrobank_y, x=c(2012,2013,2014,2015,2016), 
                y =gold/dual_currency_basket, 
                name = "gold / dual currancy basket", type = "bar")
# Adding the variable
p131 <- add_trace(centrobank_y, x=c(2012,2013,2014,2015,2016), 
                  y=silver100/dual_currency_basket, 
                  name = "silver100 / dual currancy basket", type = "bar")
# Adding the variable
p132 <- add_trace(centrobank_y, x=c(2012,2013,2014,2015,2016), 
                  y=palladium/dual_currency_basket, 
                  name = "palladium / dual currency basket", type = "bar")
# Adding the variable
p133 <- add_trace(centrobank_y, x=c(2012,2013,2014,2015,2016), 
                  y=platinum/dual_currency_basket, 
                  name = "platinum / dual currency basket", type = "bar")
# Creating layout of the plot
pl5 <- layout(p133, title = t1, 
                   xaxis = list(title = x1, showgrid = F), 
                   yaxis = list(title = y1, showgrid = F))
# Displaying the plot
pl5
```

##### I combined all the indicators to watch the overall trend: how the ratio of the prices of precious metals to the value of the dual currency basket varies with time.

##### 5.1.5 Plots for exchange rates and prices of precious metals.

##### For combining all the rates and prices on the same graphs I created and added the variables for indicators with coefficients: 50 USD, 50 EUR, 300 CNY, 4000 JPY, 100 BRL, 3000 INR, 100g of silver.

```{r Data_Series_1}
# Creating and adding the variables for indicators with coefficients
centrobank$USD50 <- 50*centrobank$USD_840
centrobank$EUR50 <- 50*centrobank$EUR_978
centrobank$CNY300 <- 300*centrobank$CNY_156
centrobank$JPY4000 <- 4000*centrobank$JPY_392
centrobank$BRL100 <- 100*centrobank$BRL_986
centrobank$INR3000 <- 3000*centrobank$INR_356
centrobank$silver100 <- 100*centrobank$silver
```

##### For applying the package "dygraphs", I created from the source database a new data set with time series. The function xts() was very helpful.

```{r Data_Series_2}
# Creating the dataset with time series
centrobank_xts <- xts(centrobank[, -1], centrobank[, 1])
```

```{r Data_Series_3}
# Creating the variable for the list of currencies
list_v1 <- c("EUR50", "USD50", "CNY300", "JPY4000", "BRL100", "INR3000")
# Creating the dataset with time series of currencies
rates_xts <- (centrobank_xts[,list_v1])
```

##### The function dygraph() let us combine all rates on the same chart.

```{r fig.width=9, fig.height=6, Multivariate_Plots_6}
# Creating the line plot
dygraph(rates_xts, main = "Exchange Rates" ) %>%
# color options
  dyOptions(colors = RColorBrewer::brewer.pal(6, "Set2")) %>%
# displaying options
  dyHighlight(highlightCircleSize = 4, 
              highlightSeriesBackgroundAlpha = 0.5,
              hideOnMouseOut = FALSE)
```

##### This method is useful for prices of precious metals also.

```{r Data_Series_4}
# Creating the variable for the list of metals
list_v2 <- c("gold", "platinum", "palladium", "silver100")
# Creating the dataset with time series of metal prices
prices_xts <- (centrobank_xts[,list_v2])
```

```{r fig.width=9, fig.height=6, Multivariate_Plots_7}
# Creating the line plot
dygraph(prices_xts, main = "Prices for Precious Metals" ) %>%
# color options
  dyOptions(colors = RColorBrewer::brewer.pal(4, "Set2")) %>%
# displaying options
  dyHighlight(highlightCircleSize = 4, 
              highlightSeriesBackgroundAlpha = 0.5,
              hideOnMouseOut = FALSE)
```

##### The apparent advantage of this method is the ability to see the exact values of exchange rates and prices for each specific date.

## 5.2 Multivariate Analysis

##### The first graph shows the danger of some statistical predictions and conclusions. According the researches, the gold price is quite strongly dependent on the price of the dual currency basket, currency exchange rates and the prices of other precious metals, but in 2013 this indicator demonstrates a diametrically opposite behavior. This database does not allow to identify the factors that had such an influence. So, more deep researches are needed.

##### It is easy to see in the long time period that the prices of precious metals (for example, gold) and currencies show almost the same trend concerning the national currency. Only silver prices were different from everyone else. For this metal price dynamics in most cases is decreasing in the 2012-2014 period.

##### These conclusions are confirmed by three-dimensional graphics. Adding the price of silver as a variable had led to the considerable spread of the data.

##### The artificial variables combining on the bar chart show us a very interesting tendency. Yes, precious metals are traditionally considered one of the best investment funds. Their cost in the long period has been steadily increased in monetary terms. But the ratio of the prices for precious metals to the value of the dual currency basket falls from 2012 to 2016. This is particularly noticeable when the four main metals are analyzed together.

## 5.3 OPTIONAL: Building the Linear Model.

##### We can construct a model of the dependence the price of gold on the price of the currency basket and the prices of other precious metals.

##### For fitting the linear model the functions lm() and mtable() were used.

```{r, Building_Linear_Model}
# Creating the variable for the linear model
m1 <- lm(gold ~ dual_currency_basket, data = centrobank)
# extension of the model by adding variables
m2 <- update(m1, ~ . + platinum)
m3 <- update(m2, ~ . + palladium)
m4 <- update(m3, ~ . + silver)
# the table of estimates for several models
mtable(m1, m2, m3, m4)
```

##### All derived statistical coefficients unambiguously confirm the existence of relationships between these indicators and the fairly good quality of the constructed model.

##### At the same time this model is very primary and primitive. For improving prediction it needs to add some important economic indicators: prices for basic resources, prices on other important world markets and the variable that reflects the impact of uncertainty in the economy (political reasons, force majeure, etc.). The introduction of the last variable requires the use of more advanced mathematical apparatus, especially for its determination.

# 6 Final Plots and Summary

##### In this section I placed three graphs corresponding to the most interesting facts from my point of view.

### 6.1.1 Plot One

##### The first surprising finding for me is decreasing of the ratio of year means of prices of the precious metals to year means of the cost of dual currency basket.

```{r fig.width=9, fig.height=6, Plot_One_1}
# Creating the bar plot p130 with new layout options
p_final1 <- layout(p133, title = t1, barmode = 'stack', 
                   xaxis = list(title = x1, showgrid = F), 
                   yaxis = list(title = y1, showgrid = F))
# Displaying the plot
p_final1
```

### 6.1.2 Description One

##### We can see the tendency: in general the ratio of the prices for precious metals to the value of the dual currency basket falls from 2012 to 2015. Only the beginning of 2016 shows a small increase in this ratio, but not for all metals. 

##### In practice this means that precious metals are important reserves and constantly increasing in price, but they cannot be considered as an effective investment, especially for the short terms.

### 6.2.1 Plot Two

##### The next interesting fact is rigid connectivity of the main economic indicators in a unified financial system.

##### Let's look at one place on the changes in exchange rates and the prices of precious metals.

```{r Plot_Two_1}
# Creating the variable for the list of metals and currencies
list_vf <- c("EUR50", "USD50", "CNY300", "gold", "platinum")
# Creating the dataset with time series 
data_xts <- (centrobank_xts[,list_vf])
```

```{r fig.width=9, fig.height=6, Plot_Two_2}
# Creating the line plot
dygraph(data_xts, main = "Prices for Precious Metals and Exchange Rates" ) %>%
# color options
  dyOptions(colors = RColorBrewer::brewer.pal(5, "Set1")) %>%
# displaying options
  dyHighlight(highlightCircleSize = 4, 
              highlightSeriesBackgroundAlpha = 0.5,
              hideOnMouseOut = FALSE)
```

### 6.2.2 Description Two

##### The second graph shows the very similar behavior for precious metals and currencies. In the long time period they are related to each other strongly.

##### And once again we can see a period of small oscillations in the beginning of the chart and a period of sharp spikes in the end.

##### This finding may lead to a very important conclusion: for example, for the prediction of the economic situation it will be enough to set a value of 2-3 key indicators. But this dataset does not allow to find which variables should be included for that.

### 6.3.1 Plot Three

##### The third surprising fact was significantly various tendencies for the economic indicators in short and long terms. Let us estimate the difference in the behavior of prices for precious metals.

```{r Plot_Three_1}
# Creating the scatter plot
p25 <- ggplot(centrobank, 
              aes(x=dual_currency_basket, 
                  y = (gold+silver+platinum+palladium)/4, color = year)) + 
# point options and the smooth line
  geom_point(shape=7, alpha=0.5, size = 2) + geom_smooth() + 
# options of the color scale
  scale_colour_gradientn(colours=rainbow(5)) + 
# title
  ggtitle('Mean of prices for precious metals and dual currency basket,
          rubles') + 
# applying the theme
  theme_bw()
```

```{r Plot_Three_2}
# Creating the same plot with faceting by year
p26 <- ggplot(centrobank, 
              aes(x=dual_currency_basket, 
                  y = (gold+silver+platinum+palladium)/4, color = year)) + 
  geom_point(shape=7, alpha=0.5, size = 2) + 
  facet_wrap( ~ year, ncol=3, scale = 'free') + geom_smooth() + 
  scale_colour_gradientn(colours=rainbow(5)) + 
  ggtitle('Mean of prices for precious metals and dual currency basket,
          rubles') + theme_bw()
```

```{r fig.width=14, fig.height=20, Plot_Three_3}
# Combining and displaying the plots
p_final3 <- grid.arrange(p25, p26, ncol=1)
# Creating the path for the image
path12=paste(p, 'Plot_Three_3_1.png', sep = '')
# Saving the image with plots
ggsave(path12, p_final3, width = 18, height = 24)
```

### 6.3.2 Description Three

##### For the next step I had launched the arithmetic mean of the prices of precious metals. It helps me to simplify the graphical visualization.

##### The third graph represents a great difference in behavior of economic indicators: the dependence is very close to linear in the long term, but in the short terms linear relationships are very rare (actually only in 2014). 

##### It shows us clearly the influence of some unknown variables which are not represented in this dataset. In practice it also means many difficulties in predictions for short periods.

# 7 Reflection

##### The data set "centrobank" contains information on almost 1,100 days of measuring the economic indicators. The data description can be found in the file with this database on the second page.

##### In general it's a very difficult sphere for prediction because of many external factors. On my opinion, for more correct researching it needs to have the data for the period not less than 10 years, some additional indicators (prices for basic resources and prices for the same things on other important world markets). 

##### The directions for the next interesting discoveries are easy to see: 
##### 1) to collect more data for better analysis, 
##### 2) to determine the advanced mathematical tools for taking into account the impact of non-economic factors,
##### 3) to identify the basis (2-3 indicator) for prediction in a rigidly connected economic system.

##### Working over this project, I have set for myself the task of training rather than a researching. I have been studying and applying the programming language R for the first time so I had chosen the lightest model for investigating, where economic relations between the variables are obvious.

##### For these goals different plotting techniques had been used. R has a very wide range of instruments, I hope I was able to learn at least some of them.

##### In addition, I have been studying to apply this language in the R-Studio and the Jupyter Notebook. In some cases, I was unable to apply the same methodology. For example, I would like to know how to use the plotly package in the Jupyter Notebook in the Anaconda environments, but for now I use it more effective in R-Studio. Maybe I could improve it a little bit later.

##### I want to note also that the color decisions really helped me in the research. They allowed to unite  or to mark not only the variables on individual charts, but graphics in general on certain groups. As an author I want to retain the right to use the colors that help to reach these goals.

##### The broad field of research is ahead with the addition of more and more wide range of methods and indicators.