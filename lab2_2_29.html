<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Lab2_2_29</title>
    <script src="https://sagecell.sagemath.org/static/embedded_sagecell.js"></script>
    <script>$(function () {
    // Make the div with id 'mycell' a Sage cell
    sagecell.makeSagecell({inputLocation:  '#mycell',
                           template:       sagecell.templates.minimal,
                           evalButtonText: 'Activate'});
    // Make *any* div with class 'compute' a Sage cell
    sagecell.makeSagecell({inputLocation: 'div.compute',
                           evalButtonText: 'Evaluate'});
    });
    </script>
  </head>
    
  <style>
  h1 {color:#3636ff; text-shadow:5px 5px 5px #aaa;}
  h2 {color:darkblue; text-shadow:5px 5px 5px #aaa;}
  p, th {font-size:110%; text-shadow:5px 5px 5px #aaa;}
  </style> 
    
  <body>   
  <h1>&#x1F4D1; &nbsp; Лабораторная работа №2</h1>
  <h1>«Типизированный файл, записи, перечисляемый тип»</h1>
  <h2>Вариант 29</h2>      
  <h2>Задание</h2>
<p>В типизированном файле,</p> 
<p>- хранящем записи вида C1,</p>
<p>- найти (и вывести) C2,</p>
<p>- и переставить её по правилу C3</p>    
<p>(условия C1, C2 и C3 – см. в таблице ниже).</p>
<p>Для создания типизированного файла предусмотреть две возможности:</p>
<p>- а) считывание данных из заранее подготовленного нестандартного текстового файла,</p>
<p>- б) добавление данных в типизированный файл в режиме диалога.</p>
<p>Предусмотреть также возможность просмотра данных из типизированного файла.</p>
<p>Для написания своей программы воспользуйтесь примером программы, приведенным ниже.</p>
<p>Для выбора нужного действия в программе использовано меню.</p>
  <h2>1. Условие задачи</h2>            
<p>Считать данные из нестандартного текстового файла с данными C1, найти и вывести на экран C2, добавить данные C3 в режиме диалога.</p>
<p>В столбце "Тип":</p> 
<p>- п – перечисляемый,</p>
<p>- с – строковый,</p>
<p>- ч – числовой,</p>
<p>- &#42; – по вашему выбору.</p>
<p>&#42; Дату можно представить разными способами:</p>  
<p>- одной строкой ('31.12.2015' или '2015/12/31' и т.п.),</p> 
<p>- тремя целыми числами,</p> 
<p>- двумя числами и перечисляемым типом месяца,</p> 
<p>- типом TDataTime.</p>
  <h2>2. Уточненное условие задачи</h2>    
<table border="1" style="width:100%;">
  <tr><th>Тип</th><th>C1</th><th>C2</th><th>C3</th></tr>
  <tr>
    <td>п</td>
    <td>Тип (мобильный, городской, факс и т.д)</td> 
    <td>Последнюю запись с самым давним (по дате) платежом на сумму менее 200</td>
    <td>Перед первой записью файла (со сдвигом)</td>    
  </tr>
  <tr>
    <td>с</td>
    <td>Телефонный номер</td> 
    <td> - </td>
    <td> - </td>    
  </tr>
  <tr>
    <td>ч</td>
    <td>Сумма платежа</td> 
    <td> - </td>
    <td> - </td>    
  </tr>
  <tr>
    <td>&#42;</td>
    <td>Дата платежа</td> 
    <td> - </td>
    <td> - </td>    
  </tr>
</table>     
  <h2>3. Пример</h2>
<p>Задача. Найти первого Ивана c первого курса бакалавриата с хотя бы одной пятеркой из трёх оценок и изменить все его оценки на 3.</p>      
<table><tr><td style="font-size:120%;font-weight:bold;text-align:left;"><pre><code class='pascal'>
program PrjLAB2;  // два параметра – 1) имя типизир. файла, 2) имя текстового файла
{$APPTYPE CONSOLE}
 
uses
  SysUtils,     // ANSIUpperCase и др. -  смена регистра
  Windows,   // SetConsoleCP - смена кодировки
  UnLab2;   // свой модуль с типом и процедурами для решения задачи
 
//--------------------главная программа - меню -------------------------
var
  ch: char;
begin
  SetConsoleCP(1251);      // из модуля Windows
  SetConsoleOutputCP(1251);
 
  repeat
    writeln('--------------------------------------');
    writeln('D - создать новый тип.файл в диалоге; ');
    writeln('N - создать из текстового файла; ');
    writeln('F - поиск и изменение; ');
    writeln('V - просмотр;');
    writeln('E - конец.');
    write('Ваш выбор?'); readln(ch);
    writeln('--------------------------------------');
 
    ch:= UpCase(ch);  // символ в верхний регистр (латиница)
    case ch of
//--------------------------------------------------------------
//----------первая часть: создание типизированного в диалоге ---
    'D': CreateTypedFile1;  // вызов соответствующей процедуры для выбора D
//----------вторая часть: создание типизированного файла из текстового
    'N': CreateTypedFile2;
//----------третья часть: поиск и редактирование ---------------
    'F': FindIVAN;
//-----------просмотр----------------------------------------------
    'V': ViewFile;
//-----------выход----------------------------------------------
    'E': exit;
//--------------------------------------------------------------
      else
        begin
          writeln('Нет такой команды');
          write('Press ENTER'); readln;
        end;
    end;
 
  until ch='E';
end.

Исходный код модуля:
Unit  UnLab2;   // файл  UnLab2.pas
Interface
 
Uses
  SysUtils;     // ANSIUpperCase и др. -  смена регистра и обработка исключений
 
Type
  TKurs = (Bacalavr1, Bac2, Bac3, Bac4, Magistr1, Mag2); // с 0 до 5 по умолчанию
  TStud = record
    FIO: record
      F, I, O: string[30]; // Только статические строки можно сохранить в файл
      end;
    Kurs: TKurs;
    o1,o2,o3: byte;
  end;
 
//----------первая часть: создание типизированного файла в диалоге
Procedure CreateTypedFile1();
 
//----------вторая часть: создание типизированного файла из текстового
Procedure CreateTypedFile2();
 
//-------------- третья часть: поиск в типизированном файле ----
Procedure FindIVAN();
 
//-------------- просмотр типизированного файла ----
Procedure ViewFile();
 
Implementation // -----------реализационная часть-----------------
 
//----------первая часть: создание типизированного файла в диалоге
Procedure CreateTypedFile1();
var
  Stud: TStud;
  fr: file of TStud; // типизированный файл - файл записей
  n, kol: integer;
  ch: char;
  FileName:string[80];
begin
  if ParamCount<1 then
  begin
    writeln('Мало параметров '#13#10'Press enter');
    readln;  exit
  end;
  FileName := ParamStr(1);
// или простой диалог или через параметры программы при её вызове ParamStr(1)
// writeln('Введите имя типизированного файла');
// readln(FileName);
 
  AssignFile(fr, FileName);
  Try  ReWrite(fr);    //  или  {$I-} ReWrite(fr); {$I+} и if IOResult<>0 then <ошибка>
  Except
    writeln('Error: не удалось создать типизированный файл ',FileName);
    write('Press ENTER'); readln;  exit
  end;
 
  kol:=0;
  repeat
    write('Фамилия =?');   readln(Stud.FIO.F);
    write('Имя =?');       readln(Stud.FIO.I);
    write('Отчество =?');  readln(Stud.FIO.O);
// ввод значения перечисляемого типа (TKurs) через доп.переменную n целого типа
    write('Курс(1-6) =?'); readln(n); Stud.Kurs:=TKurs(n-1);  // 1-6 → 0-5
    write('Три оценки: ');
    readln(Stud.o1, Stud.o2, Stud.o3);
 
    write(fr, Stud);   // запись записи целиком в файл
    inc(kol);
 
    write('Ещё? (y/n)');
    readln(ch)
  until UpCase(ch)='N';
 
  CloseFile(fr);
 
  writeln('Создан типизированный файл из ',kol,' записей');
  write('Press ENTER');
  readln;
end;
 
//---------------------------------------------------------------------------------------
//----------вторая часть: создание типизированного файла из текстового
Procedure CreateTypedFile2();
var
  Stud: TStud;
  ft: TextFile; // текстовый файл
  fr: file of TStud; // типизированный файл - файл записей
  n, kol: integer;
  ch: char;
  FileName:string[80];
begin
  if ParamCount<2 then
  begin
    writeln('Мало параметров '#13#10'Press enter');
    readln;  exit
  end;
 
FileName:= Paramstr(2);
 // или простой диалог или через параметры программы при её вызове ParamStr(2)
// writeln('Введите имя текстового файла');
// readln(FileName); 
 
 AssignFile(ft, FileName);
  Try  Reset(ft);
  Except
    writeln('Error: не удалось открыть текстовый файл ',Paramstr(2));
    write('Press ENTER'); readln;  exit
  end;
 
 
  //----------------- ЗАГЛУШКА --------------------
  //------------ Напишите код сами, а пока в диалоге: ----------------
              CreateTypedFile1; // заглушка - создание в диалоге –  заменить на свой код
 
  CloseFile(ft);
 
  write('Press ENTER');
  readln;
end;
 
//--------------------------------------------------------------
//-------------- третья часть: поиск в типизированном файле ----
Procedure FindIVAN();
var
  Stud: TStud;
  fr: file of TStud;
  n, kol: integer;
  FileName:string[80];
begin
  if ParamCount<1 then
  begin
    writeln('Мало параметров '#13#10'Press enter');
    readln;  exit
  end;
 
  FileName := ParamStr(1);
// или простой диалог или через параметры программы при её вызове ParamStr(1)
// writeln('Введите имя типизированного файла');
// readln(FileName); 
 
  AssignFile(fr, FileName);
  Try  ReSet(fr);    //  или  {$I-} ReSet(fr); {$I+} if IOResult<>0 then
  Except
    writeln('Error: не удалось открыть типизированный файл ',FileName);
    write('Press ENTER'); readln;  exit
  end;
 
  kol:=0;
  while not eof(fr) and (kol=0) do
  begin
    read(fr, Stud); // считывание
       // Если Иван c первого курса бакалавриата с хотя бы одной пятеркой
    if ((Stud.o1=5) or (Stud.o2=5) or (Stud.o3=5)) and
      (Stud.Kurs = Bacalavr1) and
      (ANSIUpperCase(Stud.FIO.I) = 'ИВАН') then  // сравнение в верхнем регистре
    begin
      writeln('Найден ', Stud.FIO.I,' ',Stud.FIO.O,' ',Stud.FIO.F,
      ' оценки ', Stud.o1, ' ', Stud.o2,' ', Stud.o3 );
      inc(kol);
      // Изменение считанного
      Stud.o1:=3; Stud.o2:=3; Stud.o3:=3;
      n:=FilePos(fr)-1; // позиция найденной записи – перед текущей
      // запись изменений "поверх" предыдущей версии
      seek(fr, n); // изменить тек.позицию в файле
      write(fr, Stud);       // запись в файле изменена
      writeln('В файле изменена запись номер ', n+1)
    end;
  end;
 
  if kol=0 then
    writeln('Данные, соответствующие запросу, не найдены');
 
  CloseFile(fr);
 
  write('Press ENTER');  readln;
end;
//--------------------------------------------------------------
//-------------- просмотр типизированного файла ----
Procedure ViewFile();
var
  Stud: TStud;
  fr: file of TStud;
  n, kol: integer;
  FileName:string[80];
begin
  if ParamCount<1 then
  begin
    writeln('Мало параметров '#13#10'Press enter');
    readln;  exit
  end;
 
  FileName := ParamStr(1);
// или простой диалог или через параметры программы при её вызове ParamStr(1)
// writeln('Введите имя типизированного файла');
// readln(FileName); 
 
  AssignFile(fr, FileName);
  Try  ReSet(fr);    //  или  {$I-} ReSet(fr); {$I+} if IOResult<>0 then
  Except
    writeln('Error: не удалось открыть типизированный файл ',FileName);
    write('Press ENTER'); readln;  exit
  end;
 
  kol:=0;
  while not eof(fr) do
  begin
    read(fr, Stud); // считывание
 
      writeln('Найден ', Stud.FIO.I,' ',Stud.FIO.O,' ',Stud.FIO.F,
      ' курс ', Ord(Stud.Kurs)+1,
      ' оценки ', Stud.o1, ' ', Stud.o2,' ', Stud.o3 );
      inc(kol);
  end;
 
  if kol=0 then
    writeln('Данные не найдены')
  else
    writeln('Найдено ',kol, ' записей');
 
  CloseFile(fr);
 
  write('Press ENTER');  readln;
end;
 
End.
</code></pre></td></tr></table> 
<p>Примеры для тестирования.</p>
<table border="1" style="width:50%;">
  <tr><th>Номер</th><th>Пример</th></tr>
  <tr><td>   1</td><td> - </td></tr>
  <tr><td>   2</td><td> - </td></tr>
  <tr><td>   3</td><td> - </td></tr>
  <tr><td>   4</td><td> - </td></tr>
  <tr><td>   5</td><td> - </td></tr>
  <tr><td>   6</td><td> - </td></tr>
  <tr><td>   7</td><td> - </td></tr>
  <tr><td>   8</td><td> - </td></tr>
  <tr><td>   9</td><td> - </td></tr>
</table>     
<p>Для запуска теста нажмите кнопку «Activate».</p>
<div id="mycell"><script type="text/x-sage">

</script></div>
<p>Для проверки результата нажмите кнопку «Evaluate».</p>
<p>Ячейки SageMath для экспериментов</p>     
<div class="compute"><script type="text/x-sage">

</script></div>
<p></p>
<div class="compute"><script type="text/x-sage">

</script></div>      
<p>Дополнительная ячейка для тестирования фрагментов кода</p>
<div class="compute"><script type="text/x-sage">

</script></div>
<p>Ячейки для экспериментов на других языках: R, HTML, JavaScript</p>
<div class="compute"><script type="text/x-sage">
%%r

</script></div>
<p></p>
<div class="compute"><script type="text/x-sage">
%%html

</script></div>
<p></p>
<div class="compute"><script type="text/x-sage">
%%javascript

</script></div>
  <h2>4. Таблица данных</h2>
<table border="1" style="width:100%;">
  <tr><th>Класс</th><th>Имя</th><th>Описание (смысл)</th><th>Тип</th><th>Структура</th><th>Формат</th></tr>
  <tr><td>исходные</td><td> - </td><td> - </td><td> - </td><td> - </td><td> - </td></tr>
  <tr><td>выходные</td><td> - </td><td> - в</td><td> - </td><td> - </td><td> - </td></tr>
  <tr><td>выходные</td><td> - </td><td> - </td><td> - </td><td> - </td><td> - </td></tr>
  <tr><td>промежуточные</td><td> - </td><td> - </td><td>цел</td><td> - </td><td> - </td></tr>
</table> 
  <h2>5,6. Форма ввода/вывода</h2>
<table border="1" style="width:50%;">
  <tr><th>Форма ввода</th><th>Форма вывода </th><tr>      
  <tr><td> - </td><td> - </td></tr>
  <tr><td> - </td><td> - </td></tr>  
  <tr><td> - </td><td> - </td></tr>
  <tr><td> - </td><td> - </td></tr>
</table>
  <h2>7. Аномалии</h2>
<table border="1" style="width:100%;">
  <tr><th>№</th><th>Описание</th><th>Условие</th><th>Ожидаемая реакция</th></tr>
  <tr><td>1</td><td> - </td><td> - </td><td> - </td></tr>
  <tr><td>2</td><td> - </td><td> - </td><td> - </td></tr>
</table>       
  <h2>8. Функциональные тесты</h2>
<table border="1" style="width:100%;">
  <tr><th>№</th><th>Исходные данные</th><th>Ожидаемый результат</th><th>Смысл теста</th></tr>
  <tr><td>1</td><td> - </td><td> - </td><td> - </td></tr>
  <tr><td>2</td><td> - </td><td> - </td><td> - </td></tr>
  <tr><td>3</td><td> - </td><td> - </td><td> - </td></tr>
  <tr><td>4</td><td> - </td><td> - </td><td> - </td></tr>
  <tr><td>5</td><td> - </td><td> - </td><td> - </td></tr>
  <tr><td>6</td><td> - </td><td> - </td><td> - </td></tr>
  <tr><td>7</td><td> - </td><td> - </td><td> - </td></tr>
  <tr><td>8</td><td> - </td><td> - </td><td> - </td></tr>
  <tr><td>9</td><td> - </td><td> - </td><td> - </td></tr>
</table>
  <h2>9. Метод</h2>
  <h2>10. Основной алгоритм</h2>
<div style="width:450px; height:650px; overflow:auto;"><img src="" width="440" height="640"/></div>
  <h2>11. Программный код Pascal</h2>
<a href="http://www.compileonline.com/compile_pascal_online.php">Онлайн-компилятор для проверки фрагментов кода Pascal</a>

<table><tr><td style="font-size:120%;font-weight:bold;text-align:left;"><pre><code class='pascal'>

</code></pre></td></tr></table>    
  <h3>Исходный код модуля<h3> 
      
<table><tr><td style="font-weight:bold;text-align:left;"><pre><code class='pascal'> 

</code></pre></td></tr></table>       
  <h2>12. Алгоритмы процедур</h2>
  </body>
</html>